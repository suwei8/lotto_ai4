# 【老苏组选/直选号码生成器 + 盈利模拟】Xuanhao_3D_P3 - 功能需求文档

## 1. 页面背景
提供“组选/直选”两种选号模式，支持和值/跨度/奇偶/大小/连号等高级过滤，生成号码组合，并进行倍数、投注成本、奖金与收益估算；附带“定位调整器”用于按位重排与筛选。

## 2. 功能需求

模块A：模式选择
- 功能描述：切换“组选”或“直选”模式。
- 输入与输出
  - 输入：mode ∈ {组选, 直选}
  - 输出：驱动后续不同输入项与生成逻辑
- 依赖：前端状态（无数据库）

模块B：高级过滤条件（通用）
- 功能描述：对候选组合进行二次过滤。
- 输入与输出
  - 输入：
    - 和值过滤（排除）：multiselect [0..27]
    - 和值范围（保留）：slider [min,max] ⊆ [0..27]
    - 跨度过滤（排除）：multiselect [0..9]
    - 跨度范围（保留）：slider [min,max] ⊆ [0..9]
    - 奇偶比（保留）：multiselect {3:0, 2:1, 1:2, 0:3}
    - 大小比（保留）：multiselect {3:0, 2:1, 1:2, 0:3}（阈值5划分大小）
    - 排除连号：checkbox
  - 输出：过滤后的号码集合
- 规则说明：
  - 奇偶比：odd = count(d%2==1)，even = 3 - odd
  - 大小比：big = count(d>=5)，small = 3 - big
  - 连号：排序后任意相邻差为1视为包含连号

模块C：组选输入与生成
- 功能描述：在组选模式下生成“组六/组三”组合。
- 输入与输出
  - 输入：
    - 组选类型：{组六, 组三}
    - 包含数字 include_digits：multiselect [0..9]
    - 排除数字 exclude_digits：multiselect [0..9]
  - 输出：三位组合（元组/字符串），再经过模块B过滤
- 生成规则：
  - 组六：三位各不相同；围绕 include_digits 与未排除池的两两组合生成
  - 组三：两同一异；围绕 include_digits 生成 (d,d,x) 与 (x,x,d)，排除 exclude
- 奖金（用于收益估算）：
  - 组六：280/注；组三：550/注

模块D：直选输入与生成
- 功能描述：在直选模式下按位生成号码，并可过滤组三/豹子/组六。
- 输入与输出
  - 输入：
    - 过滤形态：过滤组三、过滤豹子、过滤组六（checkbox）
    - 百/十/个位候选：各位 multiselect [0..9]
    - 包含数字（任意包含）与排除数字（任意出现则剔除）
  - 输出：笛卡尔积 (百,十,个) → 形态过滤 → 模块B过滤
- 奖金（用于收益估算）：
  - 直选：1700/注

模块E：倍数/成本与收益估算
- 功能描述：基于生成注数与倍数，计算投注成本、假设奖金与收益。
- 输入与输出
  - 输入：组选倍数、直选倍数（非负整数）
  - 输出：
    - 投注注数 = len(numbers)*组选倍数 + len(numbers)*直选倍数
    - 成本 = 注数*2
    - 奖金合计与说明（根据当前模式与倍数，按一注命中假设计算）
    - 纯收益 = 奖金合计 - 成本
- 文本输出：
  - 文本框展示“组合列表（逗号分隔） + 注数/倍数/成本摘要”，便于复制

模块F：定位调整器（组选专用）
- 功能描述：对组选三位组合进行按位重排筛选，输出满足位置要求的排列。
- 输入与输出
  - 输入：百/十/个位需包含数字列表（可为空）
  - 输出：对每个三位组合生成全排列，若存在任一排列满足“位→数字集合”约束则取该排列；否则保留原组合
- 文本输出：
  - 文本框展示“定位调整后排列 + 原始注数/倍数/成本摘要”，便于复制

## 3. 非功能性需求
- 技术栈：Python 3.12 + Streamlit 最新版本
- 使用 Streamlit 的 session_state、组件扩展、st.cache_data 等优化交互与性能
- 性能
  - 防组合爆炸：限制候选位与包含数字规模；生成后尽早应用过滤；必要时分页或仅预览前N条
  - 前端计算：避免不必要的 O(n^3) 循环，注意流式处理
- 技术
  - 基于 Streamlit 最新版本，使用 session_state、组件扩展、st.cache_data 等优化交互与性能
- 交互
  - 实时反馈：参数变动后即时刷新注数/成本/收益
  - 结果排序：默认生成顺序，可扩展按和值/跨度等排序

## 4. 风险与限制
- 奖金系数为常量，若规则变化需同步更新
- 组三/组六/豹子判定需与业务口径一致（组三=两同一异，组六=全异，豹子=全同）
- 过滤顺序影响性能与结果数量，应先按位候选/包含排除，再做高级过滤